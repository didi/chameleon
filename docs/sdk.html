<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CML SDK | Chameleon 变色龙</title>
    <meta name="description" content="一套代码运行多端，一端所见即多端所见">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/brand/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.00a233fc.css" as="style"><link rel="preload" href="/assets/js/app.0d45fe40.js" as="script"><link rel="preload" href="/assets/js/61.cec3172e.js" as="script"><link rel="preload" href="/assets/js/1.6dd0cced.js" as="script"><link rel="preload" href="/assets/js/46.2d153c02.js" as="script"><link rel="preload" href="/assets/js/2.aa374fee.js" as="script"><link rel="prefetch" href="/assets/js/10.42efa711.js"><link rel="prefetch" href="/assets/js/11.b9227935.js"><link rel="prefetch" href="/assets/js/12.5c3bd9ea.js"><link rel="prefetch" href="/assets/js/13.c7abb425.js"><link rel="prefetch" href="/assets/js/14.888e7623.js"><link rel="prefetch" href="/assets/js/15.58c3679d.js"><link rel="prefetch" href="/assets/js/16.41c7debc.js"><link rel="prefetch" href="/assets/js/17.1eb547fa.js"><link rel="prefetch" href="/assets/js/18.3b05dfc7.js"><link rel="prefetch" href="/assets/js/19.8c7c8405.js"><link rel="prefetch" href="/assets/js/20.01c292bf.js"><link rel="prefetch" href="/assets/js/21.e17e896e.js"><link rel="prefetch" href="/assets/js/22.77f8221c.js"><link rel="prefetch" href="/assets/js/23.45f45090.js"><link rel="prefetch" href="/assets/js/24.5ca1452c.js"><link rel="prefetch" href="/assets/js/25.05434f9b.js"><link rel="prefetch" href="/assets/js/26.e9f6dcfd.js"><link rel="prefetch" href="/assets/js/27.7fb5ebfc.js"><link rel="prefetch" href="/assets/js/28.f82741a3.js"><link rel="prefetch" href="/assets/js/29.063efd71.js"><link rel="prefetch" href="/assets/js/30.acaf8eeb.js"><link rel="prefetch" href="/assets/js/31.4f7b8c3e.js"><link rel="prefetch" href="/assets/js/32.31b343b8.js"><link rel="prefetch" href="/assets/js/33.2358d324.js"><link rel="prefetch" href="/assets/js/34.8f0025b8.js"><link rel="prefetch" href="/assets/js/35.43636d2e.js"><link rel="prefetch" href="/assets/js/36.5f7353ce.js"><link rel="prefetch" href="/assets/js/37.4af1df72.js"><link rel="prefetch" href="/assets/js/38.48b9db09.js"><link rel="prefetch" href="/assets/js/39.c213c4e2.js"><link rel="prefetch" href="/assets/js/40.405ff8e0.js"><link rel="prefetch" href="/assets/js/41.699a2dac.js"><link rel="prefetch" href="/assets/js/42.0e20b155.js"><link rel="prefetch" href="/assets/js/43.77699b2c.js"><link rel="prefetch" href="/assets/js/44.5cdea486.js"><link rel="prefetch" href="/assets/js/45.96b0490a.js"><link rel="prefetch" href="/assets/js/47.949a18e1.js"><link rel="prefetch" href="/assets/js/48.e9f5d75c.js"><link rel="prefetch" href="/assets/js/49.9e69d749.js"><link rel="prefetch" href="/assets/js/5.7144d2e8.js"><link rel="prefetch" href="/assets/js/50.b8f6aaac.js"><link rel="prefetch" href="/assets/js/51.0cc99ccb.js"><link rel="prefetch" href="/assets/js/52.c69f8caf.js"><link rel="prefetch" href="/assets/js/53.612c3651.js"><link rel="prefetch" href="/assets/js/54.601da201.js"><link rel="prefetch" href="/assets/js/55.c5cf392e.js"><link rel="prefetch" href="/assets/js/56.db7bca97.js"><link rel="prefetch" href="/assets/js/57.40fc3d18.js"><link rel="prefetch" href="/assets/js/58.6f66ea1d.js"><link rel="prefetch" href="/assets/js/59.950d8e0c.js"><link rel="prefetch" href="/assets/js/6.64a6d5e1.js"><link rel="prefetch" href="/assets/js/60.39859fe9.js"><link rel="prefetch" href="/assets/js/62.1cafc4a9.js"><link rel="prefetch" href="/assets/js/63.429bc2b2.js"><link rel="prefetch" href="/assets/js/64.5a2e84c4.js"><link rel="prefetch" href="/assets/js/65.6a05d03b.js"><link rel="prefetch" href="/assets/js/66.d8529f4b.js"><link rel="prefetch" href="/assets/js/67.bd639868.js"><link rel="prefetch" href="/assets/js/68.dd196b17.js"><link rel="prefetch" href="/assets/js/69.6a9d0df1.js"><link rel="prefetch" href="/assets/js/7.0c95294f.js"><link rel="prefetch" href="/assets/js/70.7dfa07a5.js"><link rel="prefetch" href="/assets/js/71.b528f459.js"><link rel="prefetch" href="/assets/js/72.89fa0abc.js"><link rel="prefetch" href="/assets/js/73.f124a5c5.js"><link rel="prefetch" href="/assets/js/74.bde93ac9.js"><link rel="prefetch" href="/assets/js/75.5958cd40.js"><link rel="prefetch" href="/assets/js/76.cfc67257.js"><link rel="prefetch" href="/assets/js/77.9e7b4620.js"><link rel="prefetch" href="/assets/js/78.dd844e13.js"><link rel="prefetch" href="/assets/js/79.01a1f25d.js"><link rel="prefetch" href="/assets/js/8.a3dd6c59.js"><link rel="prefetch" href="/assets/js/80.551e4c7d.js"><link rel="prefetch" href="/assets/js/81.7862d398.js"><link rel="prefetch" href="/assets/js/82.ca0b0126.js"><link rel="prefetch" href="/assets/js/83.f7e90a60.js"><link rel="prefetch" href="/assets/js/84.53e1e537.js"><link rel="prefetch" href="/assets/js/85.ba784460.js"><link rel="prefetch" href="/assets/js/86.b6bda99b.js"><link rel="prefetch" href="/assets/js/87.7b28a242.js"><link rel="prefetch" href="/assets/js/88.02363c25.js"><link rel="prefetch" href="/assets/js/89.e5a5cd69.js"><link rel="prefetch" href="/assets/js/9.04e5932c.js"><link rel="prefetch" href="/assets/js/90.53d35d0f.js"><link rel="prefetch" href="/assets/js/91.5059bfd5.js"><link rel="prefetch" href="/assets/js/92.485d2cca.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.24d076ec.js">
    <link rel="stylesheet" href="/assets/css/0.styles.00a233fc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/brand/logo.png" alt="Chameleon 变色龙" class="logo"> <span class="site-name can-hide">Chameleon 变色龙</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link router-link-active">
  文档
</a></div><div class="nav-item"><a href="/components/" class="nav-link">
  组件
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/tutorial/" class="nav-link">
  教程
</a></div><div class="nav-item"><a href="/faq/" class="nav-link">
  FAQ
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link router-link-active">
  文档
</a></div><div class="nav-item"><a href="/components/" class="nav-link">
  组件
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/tutorial/" class="nav-link">
  教程
</a></div><div class="nav-item"><a href="/faq/" class="nav-link">
  FAQ
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/introduction.html" class="sidebar-link">介绍</a></li><li><a href="/docs/setup.html" class="sidebar-link">起步</a></li><li><a href="/docs/cli.html" class="sidebar-link">命令行工具 (CLI)</a></li><li><a href="/docs/folder.html" class="sidebar-link">目录结构</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/view.html" class="sidebar-link">视图层</a></li><li><a href="/docs/cmss.html" class="sidebar-link">CMSS介绍</a></li><li><a href="/docs/cml.html" class="sidebar-link">CML 语法</a></li><li><a href="/docs/cml-vue.html" class="sidebar-link">CML - 类 Vue 语法</a></li><li><a href="/docs/logic.html" class="sidebar-link">逻辑层</a></li><li><a href="/docs/store.html" class="sidebar-link">数据管理</a></li><li><a href="/docs/custom.html" class="sidebar-link">自定义组件</a></li><li><a href="/docs/config.html" class="sidebar-link">配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>高级指引</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/poly.html" class="sidebar-link">多态协议</a></li><li><a href="/docs/build.html" class="sidebar-link">工程化</a></li><li><a href="/docs/io.html" class="sidebar-link">导入与导出</a></li><li><a href="/docs/sdk.html" class="active sidebar-link">CML SDK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/sdk.html#ios-sdk" class="sidebar-link">iOS SDK</a></li><li class="sidebar-sub-header"><a href="/docs/sdk.html#android-sdk" class="sidebar-link">Android SDK</a></li><li class="sidebar-sub-header"><a href="/docs/sdk.html#sdk-独有方法" class="sidebar-link">SDK 独有方法</a></li><li class="sidebar-sub-header"><a href="/docs/sdk.html#端-js-包缓存、更新、预加载" class="sidebar-link">端 JS 包缓存、更新、预加载</a></li></ul></li><li><a href="/docs/mvvm.html" class="sidebar-link">定制扩展端</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>迁移</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/migrate-guide.html" class="sidebar-link">CML 迁移指南</a></li><li><a href="/docs/migrate-wx-to-cml.html" class="sidebar-link">迁移微信小程序项目到 CML</a></li><li><a href="/docs/migrate-vue-to-cml.html" class="sidebar-link">迁移 Vue 项目到 CML</a></li><li><a href="/docs/migrate-weex-to-cml.html" class="sidebar-link">迁移 Weex 项目到 CML</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="cml-sdk"><a href="#cml-sdk" class="header-anchor">#</a> CML SDK</h1> <p>Native SDK 目标让客户端上趋近于各类小程序引擎，使同一套代码平滑在客户端上运行。</p> <p>使用 CML 的渲染能力，需要集成对应平台的 SDK。请在左侧目录中根据你需要接入的平台来查看文档。</p> <h2 id="ios-sdk"><a href="#ios-sdk" class="header-anchor">#</a> iOS SDK</h2> <p>CML iOS SDK 使用 Weex、React Native 与 WebView 作为基础渲染引擎，提供了基础的组件功能之外，还支持用户扩展自己的功能组件。</p> <h3 id="环境要求"><a href="#环境要求" class="header-anchor">#</a> 环境要求</h3> <p>CML 最低支持的 iOS deployment target 为：<strong><code>iOS 9.0</code></strong>
CML 使用<code>Cocoapods</code>进行管理，使用<code>npm</code>管理<code>react_native</code>。</p> <table><thead><tr><th>组件名</th> <th>依赖版本</th> <th>备注</th></tr></thead> <tbody><tr><td>Cocoapods</td> <td><strong><code>1.3.1</code></strong></td> <td>-</td></tr> <tr><td>npm</td> <td>最新版本即可</td> <td>-</td></tr> <tr><td>Weex SDK</td> <td><strong><code>0.19.0.2</code></strong></td> <td>-</td></tr> <tr><td>React Native</td> <td><strong><code>0.57.6</code></strong></td> <td>-</td></tr> <tr><td>React</td> <td><strong><code>16.6.1</code></strong></td> <td>-</td></tr></tbody></table> <h3 id="详细集成"><a href="#详细集成" class="header-anchor">#</a> 详细集成</h3> <p>当 SDK 下载下来后，首先进入<code>/chameleon-sdk-iOS/Chameleon/react_native</code>,并运行<code>npm install</code>进行更新。（这也是 React Native 的更新办法。）</p> <p>接下来我们以 Demo 工程为例（要注意工程路径位置,在工程实际配置中需要注意 :path 的内容）。</p> <p>在 Podfile 中，写入：</p> <div class="language- extra-class"><pre><code>platform :ios, '9.0'

target 'Chameleon_Example' do

    ##CML        pod 'Chameleon', :path =&gt; '../Chameleon/'

    ## 如果需要Weex，则写入weex依赖。
    pod 'WeexSDK', '~&gt; 0.19.0.2'

    ## 如果需要react_native，则写入react_native依赖。
    pod 'React', :path =&gt; '../Chameleon/react_native/node_modules/react-native', :subspecs =&gt; [
    'Core',
    'CxxBridge', ##  如果RN版本 &gt;= 0.45则加入此行
    'DevSupport', ##  如果RN版本 &gt;= 0.43，则需要加入此行才能开启开发者菜单
    'RCTText',
    'RCTNetwork',
    'RCTWebSocket', ##  这个模块是用于调试功能的
    ]

    pod 'yoga', :path =&gt; '../Chameleon/react_native/node_modules/react-native/ReactCommon/yoga'
    pod 'DoubleConversion', :podspec =&gt; '../Chameleon/react_native/node_modules/react-native/third-party-podspecs/DoubleConversion.podspec'
    pod 'glog', :podspec =&gt; '../Chameleon/react_native/node_modules/react-native/third-party-podspecs/GLog.podspec'
    pod 'Folly', :podspec =&gt; '../Chameleon/react_native/node_modules/react-native/third-party-podspecs/Folly.podspec'

end
</code></pre></div><p>将 podfile 保存，并运行 pod install。</p> <h3 id="常见问题"><a href="#常见问题" class="header-anchor">#</a> 常见问题</h3> <ul><li><p>Multiple commands produce</p> <div class="language- extra-class"><pre><code>  Showing All Messages
  :-1: Multiple commands produce 'XXXXX':
  1) Target 'Chameleon_Example' has create directory command with output 'XXXXp'
  2) That command depends on command in Target 'Chameleon_Example': script phase “[CP] Copy Pods Resources”
</code></pre></div></li></ul> <p>解决办法：删除 <code>工程-&gt;Build Phrases-&gt;[CP] Copy Pods Resources-&gt;Output files</code>下的 copy 路径。</p> <h3 id="项目目录"><a href="#项目目录" class="header-anchor">#</a> 项目目录</h3> <table><thead><tr><th>描述</th> <th>作用</th></tr></thead> <tbody><tr><td>CML</td> <td>SDK 源码与依赖文件夹</td></tr> <tr><td>Example</td> <td>react_native 依赖</td></tr></tbody></table> <p>####CMLsdk_src</p> <table><thead><tr><th>目录</th> <th>功能描述</th></tr></thead> <tbody><tr><td>CMLSDKEngine 类</td> <td>初始化 SDK、注册自定义的 Module 等功能</td></tr> <tr><td>CMLCommon</td> <td>CML 抽象层。抽象了基础的渲染页面、缓存、配置、预加载等功能。</td></tr> <tr><td>CMLReactNative</td> <td>针对 ReactNative 额外配置的部分</td></tr> <tr><td>CMLWeex</td> <td>针对 Weex 额外配置的部分</td></tr> <tr><td>CMLWeb</td> <td>针对 WebView 额外配置的部分</td></tr></tbody></table> <h3 id="提供功能"><a href="#提供功能" class="header-anchor">#</a> 提供功能</h3> <h4 id="bundle-预加载"><a href="#bundle-预加载" class="header-anchor">#</a> Bundle 预加载</h4> <ol><li><p>先设置预加载地址</p> <blockquote><div class="language- extra-class"><pre><code>[CMLEnvironmentManage chameleon].weexService.config.prefetchContents = @[@&quot;http%3A%2F%2F172.22.139.32%3A8000%2Fweex%2Fchameleon-bridge.js%3Ft%3D1546502643623&quot;];
</code></pre></div></blockquote></li> <li><p>开始预加载</p> <blockquote><div class="language- extra-class"><pre><code>    [[CMLEnvironmentManage chameleon].weexService setupPrefetch];
</code></pre></div></blockquote></li></ol> <h4 id="自动降级"><a href="#自动降级" class="header-anchor">#</a> 自动降级</h4> <p>当 Bundle 下载失败、渲染出现严重错误时，会自动降级至 H5。
<img src="/assets/img/downgrade_design_ios.287826ca.png" alt="">
降级设计图</p> <h5 id="本地-bundle-降级"><a href="#本地-bundle-降级" class="header-anchor">#</a> 本地 bundle 降级</h5> <p>当 H5 渲染失败时，倘若设置了默认的本地 bundle，会使用本地 bundle 进行降级。</p> <h5 id="主动降级"><a href="#主动降级" class="header-anchor">#</a> 主动降级</h5> <p>当渲染出现错误时，FE 可以通过 JSBridge 通知客户端触发降级。</p> <h4 id="功能扩展"><a href="#功能扩展" class="header-anchor">#</a> 功能扩展</h4> <p>使用<code>+ (void)registerModule:(NSString *)moduleName className:(NSString *)className;</code>注册自己的扩展。</p> <h3 id="使用说明"><a href="#使用说明" class="header-anchor">#</a> 使用说明</h3> <ol><li><p>初始化 SDK</p> <blockquote><div class="language- extra-class"><pre><code>[CMLSDKEngine initSDKEnvironment];
</code></pre></div></blockquote></li> <li><p>设置渲染引擎类型</p> <blockquote><div class="language- extra-class"><pre><code>[CMLEnvironmentManage chameleon].serviceType = CMLServiceTypeWeex;
</code></pre></div></blockquote></li> <li><p>设置预加载环境</p> <blockquote><div class="language- extra-class"><pre><code>[CMLEnvironmentManage chameleon].weexService.config.prefetchContents = @[@&quot;http%3A%2F%2F172.22.139.32%3A8000%2Fweex%2Fchameleon-bridge.js%3Ft%3D1546502643623&quot;];
</code></pre></div></blockquote></li> <li><p>设置预加载</p> <blockquote><div class="language- extra-class"><pre><code>[[CMLEnvironmentManage chameleon].weexService setupPrefetch];
</code></pre></div></blockquote></li></ol> <h3 id="module-的使用"><a href="#module-的使用" class="header-anchor">#</a> Module 的使用</h3> <h4 id="什么是-module"><a href="#什么是-module" class="header-anchor">#</a> 什么是 Module</h4> <p>module 是 Native 提供给前端页面调用的，完成一组操作的方法集合，用于扩展 Native 的能力。在 CML 页面中，开发者引入相关 js 库后即可调用 Module 中的方法。</p> <div class="language- extra-class"><pre class="language-text"><code>import bridge from 'chameleon-bridge';

// 主动调用客户端方法
export function sayHello() {
    bridge.callNative(
        'moduleDemo', // 模块名
        'sayHello', // 方法名
        {}, // 参数
        res =&gt; {} // 回调方法
    );
}
</code></pre></div><h4 id="使用-module"><a href="#使用-module" class="header-anchor">#</a> 使用 Module</h4> <p>Module 的使用分两种情况，一种是使用 CML SDK 内置的 Module，一种是用户自定义实现自己的 Module。</p> <h5 id="使用内置的-module"><a href="#使用内置的-module" class="header-anchor">#</a> 使用内置的 Module</h5> <p>内置的 Module 在 js 前端代码里直接使用即可，目前内置的 Module 有：</p> <ul><li>clipboard</li> <li>cml</li> <li>modal</li> <li>storage</li> <li>stream</li> <li>webSocket</li></ul> <p>API 文档里描述的能力，部分实现就是由上述 Module 支撑的。</p> <h5 id="自定义实现自己的-module"><a href="#自定义实现自己的-module" class="header-anchor">#</a> 自定义实现自己的 Module</h5> <p>示例可参看<a href="/tutorial/ios-sdk.html">CMLStorageModule 示例</a></p> <p>注册自己的 Module 关联文件:</p> <ul><li>CMLSDKEngine</li> <li>CMLConstants</li> <li>CMLUtility</li> <li>CMLModuleProtocol 非必须（该协议可获取 CMLInstance）</li></ul> <p>详细说明</p> <ul><li><p>功能：通过注册 Module 提供原生能力的扩展</p></li> <li><p>原理：依赖 bridge 进行协议通信，根据不同 Module 进行协议处理分发</p></li> <li><p>Module，扩展原生能力</p> <ul><li><p>Module 注册</p> <div class="language- extra-class"><pre class="language-text"><code>[CMLSDKEngine registerModule:@&quot;module名&quot; className:@&quot;类名&quot;];
</code></pre></div><ul><li>Module 名:两端及前端同学定义的一个名字</li></ul></li> <li><p>Module 方法实现</p> <div class="language- extra-class"><pre class="language-text"><code>  #import &quot;CMLConstants.h&quot;
  #import &quot;CMLUtility.h&quot;

  CML_EXPORT_METHOD(@selector(xxx:callBack:))

  - (void)xxx:(NSDictionary *)param callBack:(CMLMoudleCallBack)callback {

  }
</code></pre></div><ul><li>xxx:方法名，协商定义，需要跟前端一致</li> <li>param：所带参数，字典类型</li> <li>callback：回调 block (非必须)</li></ul></li> <li><p>遵循 CMLModuleProtocol 的作用</p> <ul><li>CMLModuleProtocol 协议可获取到 CMLInstance</li> <li>通过 CMLInstance 可获取当前运行环境、viewController</li></ul></li></ul></li></ul> <h3 id="预加载和缓存"><a href="#预加载和缓存" class="header-anchor">#</a> 预加载和缓存</h3> <h4 id="预加载和缓存概念"><a href="#预加载和缓存概念" class="header-anchor">#</a> 预加载和缓存概念</h4> <p>预加载和缓存都是为了节省 JSBundle 下载的时间，加快 UI 的渲染。</p> <h5 id="预加载"><a href="#预加载" class="header-anchor">#</a> 预加载</h5> <p>预加载是将下载 JSBundle 的动作提前完成，在需要用到的时候直接从本地读取并渲染。实际项目使用中，可以将需要预加载的 url 配置到预加载地址列表里，在 app 启动时提前从服务端获取，通过 CML SDK 提供的预加载能力提前下载下来。</p> <h5 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h5> <p>对于没有预加载的 JSBundle 在渲染前需要先下载，下载完成后 CML SDK 会缓存此 JSBundle，下次渲染同一个 JSBundle 时，如果此 JSBundle 没有更新则不会下载新的，达到节省时间和流量提升渲染速度的目的。</p> <h4 id="cmlcache"><a href="#cmlcache" class="header-anchor">#</a> CMLCache</h4> <p>CMLCache 是一个对 js 进行下载、缓存的一个模块，根据协议来实现 js 增量更新功能。主要有以下内容</p> <div class="language- extra-class"><pre class="language-text"><code> |
 |——CMLWeexCache   缓存模块接口类
 |——CMLCacheInfo     JsBundle文件缓存实现逻辑
 |——CMLCacheItem    jsBundle文件内存对象，描述每一个jsBundle文件的缓存状态
 |——CMLConfig    配置类，业务方可通过这个类设置是否开启缓存功能、预加载js路径、缓存大小限制、默认兜底页链接等
</code></pre></div><hr> <h5 id="cmlcache-2"><a href="#cmlcache-2" class="header-anchor">#</a> CMLCache</h5> <p>对 jsBundle 进行预加载、获取、缓存的处理对外接口。</p> <p>在该文件里，我们将拿到的 URL 解析出此页面需要加载的 jsbundle 标识，然后根据 jsBundle 标识来检测是否在本地已预加载，如果此 jsBundle 已预加载成功，则直接读本地缓存渲染；否则先从网络下载 jsBundle，然后渲染并缓存本地。</p> <p>后续我们将支持在一个 URL 中下发多段 jsbundle 标识，每段 jsbundle 标识代表这个页面的一部分，然后在根据每段 jsbundle 标识，分别从本地缓存里获取去寻找对应的 js 代码，如果不存在则从网络去下载这一段 jsBundle 并保存在本地，然后 SDK 中会将最终得到的多段 jsBundle，组合成一个完整页面的 jsBundle 加载出来。</p> <h5 id="cmlcacheinfo"><a href="#cmlcacheinfo" class="header-anchor">#</a> CMLCacheInfo</h5> <p>jsBundle 的内存管理器，是加载、获取、缓存等处理的实际操作者。
对本地缓存 jsBundle 的 maxSize 加以限制，如果超过 maxSize，则优先清除老的 jsBundle 缓存</p> <h4 id="cmlcacheitem"><a href="#cmlcacheitem" class="header-anchor">#</a> CMLCacheItem</h4> <p>对 jsBundle 的封装，包括 jsBundle 文件在本地存储的路径、内存索引；CMLCacheInfo 就是通过 CMLCacheItem 来对 jsBundle 进行操作。</p> <h5 id="使用（以-weex-为例）"><a href="#使用（以-weex-为例）" class="header-anchor">#</a> 使用（以 Weex 为例）</h5> <p><strong>缓存相关配置</strong></p> <p>缓存相关配置定义位于 CMLWeexConfig （CMLConfig）</p> <div class="language- extra-class"><pre><code>//设置服务类型为weex
[CMLEnvironmentManage chameleon].serviceType = CMLServiceTypeWeex;
//设置默认错误web链接
[CMLEnvironmentManage chameleon].weexService.config.defaultErrUrl = @“defaultErrUrl”
</code></pre></div><p>Chameleon 功能和缓存功能都是默认开启的，如果有特殊需要，可以手动关闭；另外在这里还有缓存限制 maxSize、缓存目录等配置</p> <div class="language- extra-class"><pre><code>[CMLEnvironmentManage chameleon].weexService.config.isFeatureAvailable = NO；
[CMLEnvironmentManage chameleon].weexService.config.isEnableCacheFeature = NO;
</code></pre></div><p><strong>预加载</strong></p> <p>//设置预加载 URL 列表</p> <div class="language- extra-class"><pre class="language-text"><code> [CMLEnvironmentManage chameleon].weexService.config.prefetchContents = @[@&quot;http%3A%2F%2F172.22.139.32%3A8000%2Fweex%2Fchameleon-bridge.js%3Ft%3D1546502643623&quot;];
 //开启预加载
 [[CMLEnvironmentManage chameleon].weexService setupPrefetch];
</code></pre></div><p><strong>获取加载 jsBundle 的 URL</strong></p> <div class="language- extra-class"><pre class="language-text"><code>CMLWeexCache *cache = (CMLWeexCache *)[CMLEnvironmentManage chameleon].weexService.cache;
  //在缓存中获取JSBundle的URL（本地有缓存则获取到本地缓存的URL，本地无缓存则获取到远端的URL）
        [cache getBundleCacheOfJSBundleUrl:self.bundleUrl completion:^(NSString *url, NSDictionary *parameter) {
  //加载jsBundle
  [self.render renderWithURL:[NSURL URLWithString:url] options:@{@&quot;query&quot; : [param copy]} data:nil];
}
</code></pre></div><h2 id="android-sdk"><a href="#android-sdk" class="header-anchor">#</a> Android SDK</h2> <p><a href="https://github.com/beatles-chameleon/chameleon-sdk-android" target="_blank" rel="noopener noreferrer">Github 地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>CML Android SDK 是 CML 整体框架的一部分，主要任务是完成 CML JsBundle 在 Android 端的本地渲染。SDK 底层采用 Weex 作为渲染引擎，同时扩展一些一般工程通用的基础能力，如缓存能力、降级能力等。</p> <h3 id="项目结构"><a href="#项目结构" class="header-anchor">#</a> 项目结构</h3> <p>项目一级目录结构如下：</p> <div class="language- extra-class"><pre class="language-text"><code>|+ app SDK使用示例
|+ cmlsdk SDK接入层，抽象 CML 引擎能力、实现通用扩展能力
|+ cmlweex 包装 Weex 渲染引擎
|+ cmlweb 包装 Web 渲染引擎
|+ js-bundle-mgr 实现 js bundle 预加载、缓存
|+ rich-text-component 富文本组件
|+ sdk-image 图片选择、图片拍摄组件
|+ sdk-location 位置组件
</code></pre></div><p>cmlsdk 模块单独拿出来看下目录结构：</p> <div class="language- extra-class"><pre class="language-text"><code>|- cmlsdk
    |+ adapter 定义了扩展能力的接口以及默认实现，无默认实现的能力需要第三方项目根据自己的实际业务需求去实现
    |+ bridge 定义了 js 和 Native 通信的接口，实现协议相关的处理能力，以及实现了协议层使用入口
    |+ bundle js bundle 相关定义，目前只有一个类用来描述 js bundle 相关信息
    |+ common 通用能力的基础封装类
    |+ container 渲染容器的抽象能力定义
    |+ extend CML 提供的一些能力
    |+ Module 扩展能力管理，收集 sdk 默认提供的以及第三方用户自己实现的 Module，根据 bridge 层指令执行具体某个 Module 的某个 method
    |+ utils 工具类集合
    |+ widget 自定义的widget，目前只有一个 title bar，用做 webview 渲染容器的action bar
    |- CmlBaseLifecycle 生命周期的接口定义
    |- CmlConstant 常量定义
    |- CmlEngine CML SDK 使用入口
    |- CmlEnvironment 运行环境和运行参数配置入口、扩展能力设置入口
    |- CmlInstanceManage 页面运行实例的管理类，每一个容器实例运行时，其对应的Instance会注册到这里
    |- ICmlEngine 引擎的抽象接口
    |- ICmlInstance 容器实例抽象接口
    |- ICmlActivityInstance 全屏容器实例抽象接口
    |- ICmlViewInstance 视图容器实例抽象接口
</code></pre></div><p>项目整体架构如下图所示：</p> <p><img src="/assets/img/cml_doc_android_01.9001d906.png" alt="image"></p> <h3 id="cml-使用"><a href="#cml-使用" class="header-anchor">#</a> CML 使用</h3> <p>CML Android SDK 的使用步骤如下:</p> <ul><li>引用 CML 及工程需要的相关类库</li> <li>在项目中初始化 CML SDK</li> <li>加载 JS Bundle</li></ul> <p>详细的使用方式可以参看手把手系列之<a href="/tutorial/android-sdk.html">CML Android SDK 使用范例</a>，建议<font color="#FF0000">先看使用范例</font>再阅读其他章节。</p> <p>如果需要自定义自己的 Adapter，参看<a href="#adapter-%E7%9A%84%E4%BD%BF%E7%94%A8">Adapter 的使用</a> 一节。如果需要扩展 Module，参看<a href="#module-%E7%9A%84%E4%BD%BF%E7%94%A8">Module 的使用</a>一节。</p> <h3 id="基础类说明"><a href="#基础类说明" class="header-anchor">#</a> 基础类说明</h3> <h4 id="cmlengine"><a href="#cmlengine" class="header-anchor">#</a> CmlEngine</h4> <p>此类是 <em>Chameleon/kəˈmiːlɪən/</em> SDK 的入口类，提供基本的初始化入口和 <em>Chameleon</em>容器的调起能力。具体包含以下能力</p> <ul><li>SDK 初始化入口</li> <li>调起渲染容器</li> <li>初始化预加载列表</li> <li>注册扩展 Module</li></ul> <h4 id="cmlenvironment"><a href="#cmlenvironment" class="header-anchor">#</a> CmlEnvironment</h4> <p>CmlEnvironment 主要提供了开发期间需要的一些能力，如</p> <ul><li>调试开关</li> <li>降级开关</li> <li>缓存开关</li></ul> <p>以及一些常量的定义，如</p> <ul><li>预加载的最大缓存</li> <li>运行时的最大缓存</li></ul> <p>adapter 设置和获取，详情参看<a href="#adapter-%E7%9A%84%E4%BD%BF%E7%94%A8">Adapter 的使用</a>一节</p> <ul><li>各种能力的自定义实现配置入口</li></ul> <h3 id="富文本组件"><a href="#富文本组件" class="header-anchor">#</a> 富文本组件</h3> <p>富文本是 CML 里唯一一个默认注册的组件，主要有以下内容</p> <div class="language- extra-class"><pre class="language-text"><code> |
 |-richinfo     主要是富文本需要定义的协议、点击事件的回调等
 |-utils    工具类，主要是加载assets下默认的字体
 |-CmlRichTextComponent     继承与与CmlComponent的富文本组件
 |-CmlRichTextEngine     富文本入口类，
</code></pre></div><hr> <h4 id="richinfo"><a href="#richinfo" class="header-anchor">#</a> richinfo</h4> <ul><li>CmlClickSpanListener：富文本点击事件回调</li> <li>CmlCustomTypefaceSpan：加载自定义字体</li> <li>CmlRichInfo：富文本协议及实现</li> <li>CmlRichInfoSpan：配合 CmlRichInfo 显示富文本文字，可直接设置给 TextView</li></ul> <h4 id="utils"><a href="#utils" class="header-anchor">#</a> utils</h4> <ul><li>CmlFontUtil：主要就是加载自定义字体，如 assets 下 fonts 包下的 Barlow-Medium.ttf 字体</li></ul> <h3 id="module-的使用-2"><a href="#module-的使用-2" class="header-anchor">#</a> Module 的使用</h3> <p>github 地址<a href="https://github.com/beatles-chameleon/chameleon-sdk-android" target="_blank" rel="noopener noreferrer">点这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><font color="#FF0000">根目录 assets 目录下的 cml-demo-say.zip</font> 是个简单的示例工程，用来演示 Native 和 Weex 容器或 Web 容器的双向通信</p> <h4 id="什么是-module-2"><a href="#什么是-module-2" class="header-anchor">#</a> 什么是 Module</h4> <p>module 是 Native 提供给前端页面调用的，完成一组操作的方法集合，用于扩展 Native 的能力。在 CML 页面中，开发者引入相关 js 库后即可调用 Module 中的方法。</p> <div class="language- extra-class"><pre class="language-text"><code>import bridge from 'chameleon-bridge';

// 主动调用客户端方法
export function sayHello() {
    bridge.callNative(
        'moduleDemo', // 模块名
        'sayHello', // 方法名
        {}, // 参数
        res =&gt; {} // 回调方法
    );
}
</code></pre></div><h4 id="使用-module-2"><a href="#使用-module-2" class="header-anchor">#</a> 使用 Module</h4> <p>Module 的使用分两种情况，一种是使用 CML SDK 内置的 Module，一种是用户自定义实现自己的 Module。</p> <h5 id="使用内置的-module-2"><a href="#使用内置的-module-2" class="header-anchor">#</a> 使用内置的 Module</h5> <p>内置的 Module 在 js 前端代码里直接使用即可，目前内置的 Module 有：</p> <ul><li>clipboard</li> <li>cml</li> <li>modal</li> <li>storage</li> <li>stream</li> <li>webSocket</li></ul> <p>API 里描述的能力，部分实现就是由上述 Module 支撑的。</p> <h5 id="自定义实现自己的-module-2"><a href="#自定义实现自己的-module-2" class="header-anchor">#</a> 自定义实现自己的 Module</h5> <p>示例可参看<a href="/tutorial/android-sdk.html#初始化入口">CML Android SDK 使用范例</a></p> <p>module 扩展 3 个重要的注解</p> <ul><li>@CmlModule 标注这个类是扩展模块</li> <li>@CmlMethod 标注可供 JS 侧调用的方法</li> <li>@CmlParam 标注调用的参数</li></ul> <p>详细说明</p> <ul><li><p>功能：通过注册 Module 提供原生能力的扩展</p></li> <li><p>原理：依赖 bridge 进行协议通信，根据不同 Module 进行协议处理分发</p></li> <li><p>Module，扩展原生能力</p> <ul><li>Module 注册
<ul><li>必须注册 CmlEngine.registerModule(Class&lt;?&gt; moduleClass)</li> <li>不强制要求添加@CmlModule,未添加时会使用默认设置</li> <li>不建议在运行中动态注册 Module</li></ul></li> <li>Module 名称
<ul><li>默认使用 Module 的类名</li> <li>配置 Module 名称，添加注解@CmlModule(alias = &quot;name&quot;)</li></ul></li> <li>Module 实例
<ul><li>默认为实例全局唯一，即无论有多少 instance 都会使用同一个 Module 实例</li> <li>配置全局性，添加注解@CmlModule(global = false)</li></ul></li> <li>Module 组合
<ul><li>针对极特殊情况，允许多个 class 共用一个 Module 名称</li> <li>必须有且只有一个 class 作为 Module，所有相关 class 均会使用该 moduel 配置</li> <li>其余 class 必须使用@CmlJoin(name = &quot;name&quot;)，指定需要关联的 moduel 名称</li> <li>每个 class 实例之间无关联，仅会在使用时再创建实例</li></ul></li></ul></li> <li><p>method，提供原生能力方法</p> <ul><li>method 注册
<ul><li>自动注册 Module 类中所有的 public 方法</li> <li>不强制要求添加@CmlMethod,未添加时会使用默认设置</li> <li>如果不希望方法被误添加，需要在方法上添加@CmlIgnore</li></ul></li> <li>method 名称
<ul><li>默认使用 method 方法名</li> <li>配置 method 名称，添加注解@CmlMethod(alias = &quot;name&quot;)</li></ul></li> <li>method 线程
<ul><li>默认运行在主线程</li> <li>配置 method 线程，添加注解@CmlMethod(uiThread = false)</li></ul></li></ul></li> <li><p>param，原生能力方法所需要的参数</p> <ul><li>param 类型
<ul><li>针对 Context、ICmlInstance 等上下文类型，会根据调用环境进行查找替换</li> <li>对于 CmlCallback 的类型，会构建对应的回调，需要自行处理回调</li> <li>其余类型会根据 bridge 传递的参数进行处理</li></ul></li> <li>param 参数
<ul><li>根据 birdge 传递的数据，根据参数类型进行转化</li> <li>目前可转化的类型为 JSONObject、String</li> <li>如果要直接转为对象，需要设置 CmlJsonAdapter 或接入相应 json 库</li></ul></li> <li>param 字段
<ul><li>只想获取传递数据中的某一个对象时，可以使用@CmlParam</li> <li>添加@CmlParam(name = &quot;name&quot;)，设置该参数获取的字段</li> <li>添加@CmlParam(admin = &quot;admin&quot;)，设置该参数默认值</li></ul></li></ul></li></ul> <h3 id="adapter-的使用"><a href="#adapter-的使用" class="header-anchor">#</a> Adapter 的使用</h3> <h4 id="初步认识-adapter"><a href="#初步认识-adapter" class="header-anchor">#</a> 初步认识 Adapter</h4> <p>先看个例子，对 Adapter 有个直观印象和基本概念。Chameleon SDK 里打印日志使用的是默认的 android.util.Log, 如果想替换它可以按照如下步骤实行：</p> <h5 id="替换和注册"><a href="#替换和注册" class="header-anchor">#</a> 替换和注册</h5> <p>如果用户想替换 SDK 默认提供的日志打印，可以实现 CmlLoggerAdapter 接口，并按如下方式注册进 SDK:</p> <div class="language- extra-class"><pre class="language-text"><code>// 接口实现
public class MyLoggerDefault implements CmlLoggerAdapter {
	@Override
    public void d(String tag, String msg) {
        // 这里实现自己的日志打印
    }
	...
}

// 接口注册
public class MyApplication extends Application implements ICmlConfig {
    @Override
    public void onCreate() {
        super.onCreate();
        CmlEngine.getInstance().init(this, this);
    }

    @Override
    public void configAdapter() {
        CmlEnvironment.setLoggerAdapter(new MyLoggerDefault()); // 注册自己的Adapter
        ...
    }
	...
}

</code></pre></div><p>以上就完成了日志打印能力的替换。</p> <h5 id="原理说明"><a href="#原理说明" class="header-anchor">#</a> 原理说明</h5> <p>SDK Adapter 定义和默认实现如下：</p> <div class="language- extra-class"><pre class="language-text"><code>// 日志接口定义
public interface CmlLoggerAdapter {
	void d(String tag, String msg);
	...
}

// 日志接口默认实现
public class CmlLoggerDefault implements CmlLoggerAdapter {
	@Override
    public void d(String tag, String msg) {
        Log.d(tag, msg);
    }
	...
}
</code></pre></div><p>如果用户注册了自己的 Log Adapter 实现则优先使用，否则使用 SDK 默认提供的实现。</p> <h5 id="日志打印的使用"><a href="#日志打印的使用" class="header-anchor">#</a> 日志打印的使用</h5> <p>日志打印通过 CmlLogUtil 类调用，注册自己的 Logger Adapter 后，打印日志的相关方法就会回调到自定义的方法实现里，使用示例：</p> <div class="language- extra-class"><pre class="language-text"><code>    // 日志打印
    public void launchPage(@NonNull Activity activity, String url, HashMap&lt;String, Object&gt; options) {
        if (TextUtils.isEmpty(url)) {
            CmlLogUtil.e(TAG, &quot;CmlEngine launchPage, url is empty.&quot;);
            return;
        }
        ...
    }
</code></pre></div><h4 id="adapter-基本概念"><a href="#adapter-基本概念" class="header-anchor">#</a> Adapter 基本概念</h4> <p>Adapter 的目的是定义一系列能力接口来隔离具体的实现，方便 SDK 使用者在需要时灵活替换成自己的实现。Chameleon SDK 框架层在使用 Adapter 相关能力时都是面向接口的，使用者只需要实现相关能力的 Adapter 接口并通过 SDK 注册接口进行注册，即可轻松替换成自己的实现并进行能力扩展。</p> <p>Chameleon SDK 并没有完整的实现所有 Adapter 接口，也就是说一部分有默认实现的 Adapter 可以直接使用，未提供默认实现的需要使用者自己实现，否则框架将无法使用对应的接口能力。</p> <p>Chameleon SDK 定义了如下的 Adapter 接口</p> <table><thead><tr><th style="text-align:left;">接口</th> <th style="text-align:left;">功能</th> <th style="text-align:left;">默认实现</th></tr></thead> <tbody><tr><td style="text-align:left;">ICmlDegradeAdapter</td> <td style="text-align:left;">降级</td> <td style="text-align:left;">无</td></tr> <tr><td style="text-align:left;">ICmlImgLoaderAdapter</td> <td style="text-align:left;">图片加载</td> <td style="text-align:left;">有</td></tr> <tr><td style="text-align:left;">CmlLoggerAdapter</td> <td style="text-align:left;">日志</td> <td style="text-align:left;">有</td></tr> <tr><td style="text-align:left;">ICmlNavigatorAdapter</td> <td style="text-align:left;">url 跳转</td> <td style="text-align:left;">有</td></tr> <tr><td style="text-align:left;">ICmlStatisticsAdapter</td> <td style="text-align:left;">统计信息输出</td> <td style="text-align:left;">无</td></tr> <tr><td style="text-align:left;">ICmlWebSocketAdapter</td> <td style="text-align:left;">WebSocket</td> <td style="text-align:left;">有</td></tr> <tr><td style="text-align:left;">CmlHttpAdapter</td> <td style="text-align:left;">Http 请求</td> <td style="text-align:left;">有</td></tr> <tr><td style="text-align:left;">CmlJsonAdapter</td> <td style="text-align:left;">json 解析</td> <td style="text-align:left;">有</td></tr> <tr><td style="text-align:left;">CmlDialogAdapter</td> <td style="text-align:left;">对话框</td> <td style="text-align:left;">有</td></tr> <tr><td style="text-align:left;">CmlToastAdapter</td> <td style="text-align:left;">提示浮层</td> <td style="text-align:left;">有</td></tr> <tr><td style="text-align:left;">CmlStorageAdapter</td> <td style="text-align:left;">key-&gt;value 存储</td> <td style="text-align:left;">有</td></tr> <tr><td style="text-align:left;">CmlThreadAdapter</td> <td style="text-align:left;">线程</td> <td style="text-align:left;">有</td></tr></tbody></table> <h5 id="重点-adapter-说明"><a href="#重点-adapter-说明" class="header-anchor">#</a> 重点 Adapter 说明</h5> <p>降级、对话框、提示浮层 Adapter 在 SDK 实际使用时替换可能性较大，分别说明。</p> <p><strong>降级</strong></p> <p>ICmlDegradeAdapter 降级接口没有提供默认实现，<a href="/tutorial/android-sdk.html">CML Android SDK 使用范例</a> 示例里示范了如何实现一个降级处理类 CmlDegradeDefault。
CmlDegradeDefault 默认会关闭 Native 渲染容器，并打开 Web 容器加载降级 url。</p> <div class="language- extra-class"><pre class="language-text"><code>public class CmlDegradeDefault implements ICmlDegradeAdapter {

    @Override
    public DegradeViewWrapper getDegradeView(int degradeCode) {
        return new DegradeViewWrapper() {
            CmlWebView webView;

            @Override
            public View getView(@NonNull Context context) {
                webView = new CmlWebView(context);
                webView.onCreate();
                return webView;
            }

            @Override
            public void onDestroy() {
                if (null != webView) {
                    webView.onDestroy();
                }
            }

            @Override
            public void loadURL(@NonNull Context context, @NonNull String url, @Nullable HashMap&lt;String, Object&gt; options) {
                if (null != webView) {
                    webView.render(url, null);
                }
            }
        };
    }

    @Override
    public void degradeActivity(@NonNull Activity activity, @NonNull String url, @Nullable HashMap&lt;String, Object&gt; options, int degradeCode) {
        if (url.contains(&quot;?&quot;)) {
            url = url.substring(0, url.indexOf(&quot;?&quot;));
        }
        CmlEngine.getInstance().launchPage(activity, url, null);
    }
}
</code></pre></div><p>degradeActivity 会在如下降级场景发生时回调</p> <ul><li>下载 JSBundle 失败</li> <li>解析 JSBundle 发生异常</li> <li>降级调试开关打开(在 CmlEnvironment 里设置)</li> <li>前端代码手动降级</li></ul> <p><strong>对话框</strong></p> <p>此接口定义以下两种对话框能力</p> <ul><li>showAlert</li> <li>showConfirm</li></ul> <p>CmlModalTip 实现了此接口，通过 CmlModalModule 类暴露给 JS 侧调用，前端用法参考 API<a href="/api/#交互反馈">交互反馈</a></p> <p><strong>提示浮层</strong></p> <p>此接口定义以下浮层提示能力</p> <ul><li>showToast</li></ul> <p>CmlModalTip 实现了此接口，通过 CmlModalModule 类暴露给 JS 侧调用，前端用法参考 API<a href="/api/#交互反馈">交互反馈</a></p> <h5 id="其他-adapter-说明"><a href="#其他-adapter-说明" class="header-anchor">#</a> 其他 Adapter 说明</h5> <p><strong>图片加载</strong></p> <p>CmlDefaultImgLoaderAdapter ，默认使用 Glide，需要用户手动集成 Glide</p> <p><strong>日志打印</strong></p> <p>CmlLoggerDefault，默认使用系统 log 输出</p> <p><strong>跳转</strong></p> <p>默认使用 Intent.ACTION_VIEW 处理</p> <p><strong>统计信息输出</strong></p> <p>没有默认实现，不关心可以不用实现</p> <p><strong>WebSocket</strong></p> <p>CmlDefaultWebSocketAdapter，默认使用 OkHttp3，需要用户手动集成 OkHttp3</p> <p><strong>Http 请求</strong></p> <p>执行 http 请求，并监听 http 响应</p> <p><strong>json 解析</strong></p> <p>转换成 json 字符串和反解成 json 对象</p> <p><strong>key-&gt;value 存储</strong></p> <p>前端用法参考 API<a href="/api/#数据存储">数据存储</a></p> <p><strong>线程</strong></p> <p>定义工作线程和 ui 线程</p> <h3 id="预加载和缓存-2"><a href="#预加载和缓存-2" class="header-anchor">#</a> 预加载和缓存</h3> <h4 id="预加载和缓存概念-2"><a href="#预加载和缓存概念-2" class="header-anchor">#</a> 预加载和缓存概念</h4> <p>预加载和缓存都是为了节省 JSBundle 下载的时间，加快 UI 的渲染。</p> <h5 id="预加载-2"><a href="#预加载-2" class="header-anchor">#</a> 预加载</h5> <p>预加载是将下载 JSBundle 的动作提前完成，在需要用到的时候直接从本地读取并渲染。实际项目使用中，可以将需要预加载的 url 地址列表在 app 启动时提前从服务端获取，通过 CML SDK 提供的预加载能力提前下载下来。</p> <h5 id="缓存-2"><a href="#缓存-2" class="header-anchor">#</a> 缓存</h5> <p>对于没有预加载的 JSBundle 在渲染前需要先下载，下载完成后 CML SDK 会缓存此 JSBundle，下次渲染同一个 JSBundle 时，如果此 JSBundle 没有更新则不会下载新的，达到节省时间和流量提升渲染速度的目的。</p> <h4 id="jsbundlemgr"><a href="#jsbundlemgr" class="header-anchor">#</a> JsBundleMgr</h4> <p>JsBundleMgr 是一个对 js 进行下载、缓存的一个模块，根据协议来实现 js 增量更新功能。主要有以下内容</p> <div class="language- extra-class"><pre class="language-text"><code> |
 |——cache    基于DiskLrucache来实现缓存功能
 |——code     js代码的获取及管理
 |——net      采用httpUrlConnect实现下载功能
 |——utils    工具包
 |——CmlJsBundleConstant  常量的管理
 |——CmlJsBundleEngine    实现了CmlJsBundleManager接口，入口类
 |——CmlJsBundleEnvironment   当前环境的设置，如debug环境等
 |——CmlJsBundleManager   实现此接口可自己定义JsBundle的管理
 |——CmlJsBundleMgrConfig    配置类，设置预加载js路径、缓存大小等，默认预加载及运行时缓存大小是4M，可自行设置
</code></pre></div><hr> <h5 id="code"><a href="#code" class="header-anchor">#</a> code</h5> <p>对 js 代码进行预加载、获取、缓存的管理。在该包里，我们将拿到的 url 根据协议来拆分成多个 url1、url2 等，然后在根据 url1、url2 等来获取对应的 js 代码，首先从本地缓存里获取去寻找对应的 js 代码，如果不存在则从网络去下载并保存在本地</p> <h5 id="utils-2"><a href="#utils-2" class="header-anchor">#</a> utils</h5> <p>一些文件管理、拆分 url、网络判断的工具类</p> <ul><li>CmlCodeUtils：获取到的 url、code 的拆解及合并</li> <li>CmlFileUtils：sd 卡及缓存目录的判断</li> <li>CmlLogUtils：Log 的实现</li> <li>CmlNetworkUtils：当前网络状态的判断，如 Wi-Fi、4g 等</li> <li>CmlUtils：Md5 的生成、主线程判断等等</li></ul> <h5 id="cmljsbundleconstant"><a href="#cmljsbundleconstant" class="header-anchor">#</a> CmlJsBundleConstant</h5> <p>缓存文件名、预加载优先级的管理，预加载优先级有以下三种类型</p> <ul><li>普通（PRIORITY_COMMON）：非 Wi-Fi 情况不预加载</li> <li>强预加载（PRIORITY_FORCE）：无论什么网络情况都预加载</li> <li>强预加载+预解析（PRIORITY_FORCE_MAX）：目前未用到</li></ul> <h5 id="cmljsbundleengine"><a href="#cmljsbundleengine" class="header-anchor">#</a> CmlJsBundleEngine</h5> <p>实现了 CmlJsBundleManager 接口，主要有以下三个方法</p> <ul><li>initConfig(Context,CmlJsBundleMgrConfig)：初始化 config，主要是设置预加载 url、预加载缓存、运行时缓存的设置，预加载及运行时缓存默认为 4M</li> <li>startPreload()：开始预加载，目前预加载成功或者失败并没有任何信息返回，只能查看 log 进行分析</li> <li>getWXTemplate(String,CmlGetCodeStringCallback)：获取 js 代码</li></ul> <h5 id="cmljsbundlemanager"><a href="#cmljsbundlemanager" class="header-anchor">#</a> CmlJsBundleManager</h5> <p>实现此接口可以自己定义 JsBundleMgr 的实现</p> <h5 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h5> <p><strong>添加依赖</strong></p> <div class="language-gradle extra-class"><pre class="language-text"><code>compile 'com.didiglobal.chameleon:js-bundle-mgr:latest.version'
</code></pre></div><p><strong>预加载</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>        <span class="token class-name">CmlJsBundleEnvironment</span><span class="token punctuation">.</span>DEBUG <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CmlModel</span><span class="token punctuation">&gt;</span></span> cmlModels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CmlModel</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CmlModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span>bundle <span class="token operator">=</span> <span class="token class-name">CmlUtils</span><span class="token punctuation">.</span><span class="token function">parseWeexUrl</span><span class="token punctuation">(</span>url1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span>priority <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        cmlModels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CmlModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span>priority <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span>bundle <span class="token operator">=</span> <span class="token class-name">CmlUtils</span><span class="token punctuation">.</span><span class="token function">parseWeexUrl</span><span class="token punctuation">(</span>url2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cmlModels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CmlJsBundleMgrConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CmlJsBundleMgrConfig</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPreloadList</span><span class="token punctuation">(</span>cmlModels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CmlJsBundleEngine</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CmlJsBundleEngine</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startPreload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>获取 Js 代码</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>        <span class="token class-name">CmlJsBundleEngine</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CmlJsBundleMgrConfig</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token class-name">CmlUtils</span><span class="token punctuation">.</span><span class="token function">parseWeexUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CmlJsBundleEngine</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWXTemplate</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CmlGetCodeStringCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">String</span> codes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onSuccess: &quot;</span> <span class="token operator">+</span> codes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFailed</span><span class="token punctuation">(</span><span class="token class-name">String</span> errMsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onFailed: &quot;</span> <span class="token operator">+</span> errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="sdk-独有方法"><a href="#sdk-独有方法" class="header-anchor">#</a> SDK 独有方法</h2> <h3 id="getsdkinfo"><a href="#getsdkinfo" class="header-anchor">#</a> getSDKInfo</h3> <p>获得 SDK 信息</p> <h4 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h4> <p>无</p> <h4 id="返回值"><a href="#返回值" class="header-anchor">#</a> 返回值</h4> <p>返回 promise</p> <table><thead><tr><th style="text-align:center;">返回值</th> <th style="text-align:center;">类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">version</td> <td style="text-align:center;">String</td> <td style="text-align:center;">版本号</td></tr></tbody></table> <h3 id="insdk"><a href="#insdk" class="header-anchor">#</a> inSDK</h3> <p>同步方法，判断 webview 或 Native 页面是否在 sdk 环境中，目前只用于内部封装方法使用。</p> <h4 id="参数-2"><a href="#参数-2" class="header-anchor">#</a> 参数</h4> <p>无</p> <h4 id="返回值-2"><a href="#返回值-2" class="header-anchor">#</a> 返回值</h4> <table><thead><tr><th style="text-align:center;">返回值</th> <th style="text-align:center;">类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">value</td> <td style="text-align:center;">Boolean</td> <td style="text-align:center;">true：在 sdk 环境中；false：不在 sdk 环境中</td></tr></tbody></table> <div class="language- extra-class"><pre class="language-text"><code>import bridge from 'chameleon-bridge';
const inSDK = bridge.inSDK(); // true/false
</code></pre></div><h3 id="rollbackweb"><a href="#rollbackweb" class="header-anchor">#</a> rollbackWeb</h3> <p>降级到 cmlUrl 对应的 h5 地址。</p> <h3 id="callnative-module-string-method-string-args-object-callback-function"><a href="#callnative-module-string-method-string-args-object-callback-function" class="header-anchor">#</a> callNative(module:String, method:String, args:Object, callback:Function)</h3> <p>js 调用 Native sdk</p> <div class="language- extra-class"><pre class="language-text"><code>import bridge from 'chameleon-bridge';

// 主动调用客户端方法
export function sayHello() {
    bridge.callNative(
        'moduleDemo', // 模块名
        'sayHello', // 方法名
        {}, // 参数
        res =&gt; {} // 回调方法
    );
}
</code></pre></div><h3 id="listennative-module-string-method-string-callback-function"><a href="#listennative-module-string-method-string-callback-function" class="header-anchor">#</a> listenNative(module:String, method:String, callback:Function)</h3> <p>监听客户端调用 js</p> <div class="language- extra-class"><pre class="language-text"><code>import bridge from 'chameleon-bridge';

// 监听客户端调用js
export function listenTell() {
    bridge.listenNative(
        'moduleDemo', // 模块名
        'NaTellJS', // 方法名
        res =&gt; {
         // 回调方法中处理返回的数据
        }
    );
}
</code></pre></div><h2 id="端-js-包缓存、更新、预加载"><a href="#端-js-包缓存、更新、预加载" class="header-anchor">#</a> 端 JS 包缓存、更新、预加载</h2> <h3 id="缓存策略"><a href="#缓存策略" class="header-anchor">#</a> 缓存策略</h3> <p>浏览器在加载静态资源的时候一般的话会使用两种 HTTP 缓存管理机制：</p> <ul><li>强制缓存(Cache-Control、Expires)</li> <li>协商式缓存(ETag、Last-Modified)</li></ul> <p>类似的，在使用<code>chameleon sdk</code>加载 JS 包的时候也会提供两种缓存管理机制：</p> <ul><li>基于 LRU 的强制缓存</li> <li>类 HTTP 的协商式缓存(后续发布)</li></ul> <h4 id="基于-lru-的强制缓存"><a href="#基于-lru-的强制缓存" class="header-anchor">#</a> 基于 LRU 的强制缓存</h4> <p>基于<a href="https://baike.baidu.com/item/LRU" target="_blank" rel="noopener noreferrer">LRU<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<code>缓存策略</code>，简单来说就是实现了一个<code>缓存池</code>，每次请求先从缓存池中搜索一下，如果有就直接使用缓存池中的 JS 包，如果没有，就从网络上请求 JS 包并将其缓存在缓存池中，每一份 JS 包缓存按照<code>最后使用时间</code>排序，当缓存池满了以后，将最早使用过的缓存从缓存池中<code>清理</code>出去，保证客户端上的资源占用可控。</p> <h5 id="如何配置"><a href="#如何配置" class="header-anchor">#</a> 如何配置</h5> <ul><li>iOS</li> <li>Android</li></ul> <h4 id="类-http-的协商式缓存-后续发布"><a href="#类-http-的协商式缓存-后续发布" class="header-anchor">#</a> 类 HTTP 的协商式缓存(后续发布)</h4> <p>与普通浏览器实现的协商式缓存类似，用户只需在静态资源服务端配置好静态资源的协商式缓存头部，即可实现与普通浏览器一致的方式使用协商式缓存。</p> <h3 id="更新策略"><a href="#更新策略" class="header-anchor">#</a> 更新策略</h3> <p>当 JS 包升级迭代需要在客户端内使用最新的包时，在使用两种缓存方式下，相应的存在两周更新方式，下面会详细介绍</p> <h4 id="强制缓存下的更新："><a href="#强制缓存下的更新：" class="header-anchor">#</a> 强制缓存下的更新：</h4> <p>由于强制缓存，客户端不会主动的去向服务器请求最新的更新包，会导致客户端一直使用老的版本。</p> <p>为了能够打到规避这种情况，我们提供了一种可供参考的解决方案：</p> <ol><li>配置文件指纹</li></ol> <p>设置<code>chameleon.config.js</code>中的<code>hash: true</code>，具体可参考工程化配置之<a href="/docs/config.html">文件指纹</a>， CML 项目构建出的 JS 包文件名会类似如下</p> <div class="language-bash extra-class"><pre class="language-bash"><code>test_project_c6bdf9074a821f01e70f.js
</code></pre></div><ol start="2"><li>上线打包出来的 JS 包</li></ol> <p>得到以下可以访问的资源地址</p> <div class="language-bash extra-class"><pre class="language-bash"><code>https://www.static.com/test_project_c6bdf9074a821f01e70f.js
</code></pre></div><ol start="3"><li>替换入口资源地址</li></ol> <p>将入口页面中的 cmlUrl <code>cml_addr</code> 替换成 <code>encodeURIComponent</code> 后的最新资源地址即可，比如</p> <p>原 cmlUrl:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>https://www.static.com/test_project.html?cml_addr<span class="token operator">=</span>https%3A%2F%2Fwww.static.com%2Ftest_project_21f01e70fc6bdf9074a8.js
</code></pre></div><p>新的 cmlUrl</p> <div class="language-bash extra-class"><pre class="language-bash"><code>https://www.static.com/test_project.html?cml_addr<span class="token operator">=</span>https%3A%2F%2Fwww.static.com%2Ftest_project_c6bdf9074a821f01e70f.js
</code></pre></div><p><strong>最佳实践</strong></p> <p>由于强制缓存下每次修改都需要修改入口页面的 cmlUrl 中的 <code>cml_addr</code> 参数，可能会导致修改频繁影响效率，所以建议通过后端读取 <code>map.json</code> 的方式下发跳转 cmlUrl 进行统一管理。</p> <p>具体请求过程如下图所示:</p> <p><img src="/assets/img/request_show.5559bebc.png" alt="示意图"></p> <ol><li>JS 包修改上线后，同时将<code>map.json</code>上线到服务器上</li> <li>入口页面加载数据时，服务器从<code>map.json</code>文件中查询到要跳转的 cmlUrl，并与初始化数据合并和下发给入口页面。</li> <li>入口页面逻辑将接受到的 cmlUrl 作为需要跳转的链接进行使用。</li></ol> <p>这样每次 bundle 修改后可以自动完成更新</p> <h4 id="协商式缓存下的更新："><a href="#协商式缓存下的更新：" class="header-anchor">#</a> 协商式缓存下的更新：</h4> <p>可以直接使用 http 的缓存更新策略，不需额外的配置。</p> <h3 id="预加载-3"><a href="#预加载-3" class="header-anchor">#</a> 预加载</h3> <p>在某些场景下，为了能够让页面更快的呈现在用户面前，需要让客户端提前下载一些 js 包，这时就需要用到预加载。</p> <h4 id="如何配置-2"><a href="#如何配置-2" class="header-anchor">#</a> 如何配置</h4> <ul><li>iOS</li> <li>Android 参考<a href="/tutorial/android-sdk.html">CML Android SDK 使用范例</a>第 6 节</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/io.html" class="prev">
        导入与导出
      </a></span> <span class="next"><a href="/docs/mvvm.html">
        定制扩展端
      </a>
      →
    </span></p></div> <footer class="footer" data-v-aa5c954a><div class="content" data-v-aa5c954a><div class="left" data-v-aa5c954a><a href="/" class="brand" data-v-aa5c954a><img src="data:image/png;base64,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" alt="logo" data-v-aa5c954a> <span data-v-aa5c954a>Chameleon</span></a> <div class="info" data-v-aa5c954a>Copyright © 2020 DiDi Chuxing Inc.</div></div> <div class="right" data-v-aa5c954a><div class="col" data-v-aa5c954a><h4 data-v-aa5c954a>资源</h4> <a href="/components/expand.html" data-v-aa5c954a>Chameleon UI</a><a href="https://github.com/beatles-chameleon/cml-demo" target="_blank" rel="noopener" data-v-aa5c954a>
              Chameleon Demo
            </a><a href="https://github.com/chameleon-team/awesome-cml" target="_blank" rel="noopener" data-v-aa5c954a>
              Awesome Chameleon
            </a><a href="https://github.com/didi/chameleon/releases" target="_blank" rel="noopener" data-v-aa5c954a>
              更新记录
            </a></div><div class="col" data-v-aa5c954a><h4 data-v-aa5c954a>社区</h4> <a href="https://github.com/didi/chameleon/issues" target="_blank" rel="noopener" data-v-aa5c954a>
              GitHub
            </a><a data-v-aa5c954a><span data-v-aa5c954a>微信交流群</span> <img src="/assets/img/qr_weixin.59cd000a.png" alt="image" data-v-aa5c954a></a><a data-v-aa5c954a><span data-v-aa5c954a>QQ 交流群</span> <img src="/assets/img/qr_qq.115678d7.jpg" alt="image" data-v-aa5c954a></a><a data-v-aa5c954a><span data-v-aa5c954a>顺风公鹿</span> <img src="/assets/img/qr_deer.e2ddb653.png" alt="image" data-v-aa5c954a></a></div><div class="col" data-v-aa5c954a><h4 data-v-aa5c954a>关于</h4> <a href="https://github.com/didi/chameleon/wiki/Chameleon%E5%9B%A2%E9%98%9F" target="_blank" rel="noopener" data-v-aa5c954a>
              Chameleon 团队
            </a><a href="https://github.com/didi/chameleon/wiki/%E5%8A%A0%E5%85%A5%E6%88%91%E4%BB%AC" target="_blank" rel="noopener" data-v-aa5c954a>
              加入我们
            </a><a href="mailto:CML@didichuxing.com" target="_blank" rel="noopener" data-v-aa5c954a>
              联系我们
            </a><a href="https://github.com/didi/chameleon/wiki/Contributors" target="_blank" rel="noopener" data-v-aa5c954a>
              贡献者
            </a></div></div></div></footer></main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0d45fe40.js" defer></script><script src="/assets/js/61.cec3172e.js" defer></script><script src="/assets/js/1.6dd0cced.js" defer></script><script src="/assets/js/46.2d153c02.js" defer></script><script src="/assets/js/2.aa374fee.js" defer></script>
  </body>
</html>
